DELIMITER //
CREATE DEFINER=`root`@`localhost` PROCEDURE `PERSON_SP_CREATE`(
    IN P_DS_NAME VARCHAR(30),
    IN P_DS_SURNAME VARCHAR(30),
    IN P_DS_NICKNAME VARCHAR(30),
    IN P_DS_EMAIL VARCHAR(100),
    IN P_DS_PHONE VARCHAR(30),    
    IN P_DS_PASSWORD VARCHAR(100),
    IN P_DT_BIRTH DATE
)
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        
        RESIGNAL;
    END;

    START TRANSACTION;

    INSERT INTO PERSON (
        DS_NAME, DS_SURNAME, DS_NICKNAME, DS_EMAIL, DS_PHONE, DS_PASSWORD, DT_BIRTH, ID_STATUS, DT_REGISTRY
    ) VALUES (
        P_DS_NAME, P_DS_SURNAME, P_DS_NICKNAME, P_DS_EMAIL, P_DS_PHONE, P_DS_PASSWORD, P_DT_BIRTH, 8, CURDATE()
    );

    COMMIT;

    SELECT LAST_INSERT_ID() AS ID_PERSON;
END //

DELIMITER ;